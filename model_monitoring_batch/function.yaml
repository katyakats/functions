kind: job
metadata:
  name: model-monitoring-batch
  tag: ''
  hash: 2b3c5e701c04134d76230535799a8442f1d4e1c1
  project: default
  categories:
  - monitoring
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  env: []
  default_handler: handler
  entry_points:
    compute:
      name: compute
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: capping
        default: null
      - name: kld_scaling
        default: 0.0001
      outputs:
      - default: ''
        type: float
      lineno: 64
    dict_to_histogram:
      name: dict_to_histogram
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: histogram_dict
        default: ''
      outputs:
      - default: ''
      lineno: 112
    compute_metrics_over_df:
      name: compute_metrics_over_df
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: base_histogram
        default: ''
      - name: latest_histogram
        default: ''
      outputs:
      - default: ''
      lineno: 129
    compute_drift_from_histograms:
      name: compute_drift_from_histograms
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: feature_stats
        default: ''
      - name: current_stats
        default: ''
      outputs:
      - default: ''
      lineno: 140
    post_init:
      name: post_init
      doc: ''
      parameters:
      - name: self
        default: ''
      outputs:
      - default: ''
      lineno: 281
    run:
      name: run
      doc: ''
      parameters:
      - name: self
        default: ''
      outputs:
      - default: ''
      lineno: 293
    check_for_drift:
      name: check_for_drift
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: drift_result
        default: ''
      - name: endpoint
        default: ''
      outputs:
      - default: ''
      lineno: 419
    get_last_created_dir:
      name: get_last_created_dir
      doc: ''
      parameters:
      - name: fs
        default: ''
      - name: endpoint_dir
        default: ''
      outputs:
      - default: ''
      lineno: 445
    handler:
      name: handler
      doc: ''
      parameters:
      - name: context
        type: MLClientCtx
        default: ''
      outputs:
      - default: ''
      lineno: 451
  description: ''
  build:
    functionSourceCode: aW1wb3J0IGpzb24KaW1wb3J0IG9zCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IGRlZmF1bHRkaWN0CmZyb20gZGF0YWNsYXNzZXMgaW1wb3J0IGRhdGFjbGFzcwpmcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIExpc3QsIERpY3QKCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCB2M2lvCmZyb20gbWxydW4gaW1wb3J0IGdldF9ydW5fZGIKZnJvbSBtbHJ1biBpbXBvcnQgc3RvcmVfbWFuYWdlcgpmcm9tIG1scnVuLmRhdGFfdHlwZXMuaW5mZXIgaW1wb3J0IERGRGF0YUluZmVyLCBJbmZlck9wdGlvbnMKZnJvbSBtbHJ1bi5ydW4gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4udXRpbHMgaW1wb3J0IGxvZ2dlciwgY29uZmlnCmZyb20gbWxydW4udXRpbHMubW9kZWxfbW9uaXRvcmluZyBpbXBvcnQgRW5kcG9pbnRUeXBlLCBwYXJzZV9tb2RlbF9lbmRwb2ludF9zdG9yZV9wcmVmaXgKZnJvbSBtbHJ1bi51dGlscy52M2lvX2NsaWVudHMgaW1wb3J0IGdldF92M2lvX2NsaWVudCwgZ2V0X2ZyYW1lc19jbGllbnQKZnJvbSBza2xlYXJuLnByZXByb2Nlc3NpbmcgaW1wb3J0IEtCaW5zRGlzY3JldGl6ZXIKClRJTUVfRk9STUFUID0gIiVZLSVtLSVkICVIOiVNOiVTLiVmJXoiCgoKQGRhdGFjbGFzcwpjbGFzcyBUb3RhbFZhcmlhbmNlRGlzdGFuY2U6CiAgICAiIiIKICAgIFByb3ZpZGVzIGEgc3ltbWV0cmljIGRyaWZ0IGRpc3RhbmNlIGJldHdlZW4gdHdvIHBlcmlvZHMgdCBhbmQgdQogICAgWiAtIHZlY3RvciBvZiByYW5kb20gdmFyaWFibGVzCiAgICBQdCAtIFByb2JhYmlsaXR5IGRpc3RyaWJ1dGlvbiBvdmVyIHRpbWUgc3BhbiB0CiAgICAiIiIKCiAgICBkaXN0cmliX3Q6IG5wLm5kYXJyYXkKICAgIGRpc3RyaWJfdTogbnAubmRhcnJheQoKICAgIGRlZiBjb21wdXRlKHNlbGYpIC0+IGZsb2F0OgogICAgICAgIHJldHVybiBucC5zdW0obnAuYWJzKHNlbGYuZGlzdHJpYl90IC0gc2VsZi5kaXN0cmliX3UpKSAvIDIKCgpAZGF0YWNsYXNzCmNsYXNzIEhlbGxpbmdlckRpc3RhbmNlOgogICAgIiIiCiAgICBIZWxsaW5nZXIgZGlzdGFuY2UgaXMgYW4gZiBkaXZlcmdlbmNlIG1lYXN1cmUsIHNpbWlsYXIgdG8gdGhlIEt1bGxiYWNrLUxlaWJsZXIgKEtMKSBkaXZlcmdlbmNlLgogICAgSG93ZXZlciwgdW5saWtlIEtMIERpdmVyZ2VuY2UgdGhlIEhlbGxpbmdlciBkaXZlcmdlbmNlIGlzIHN5bW1ldHJpYyBhbmQgYm91bmRlZCBvdmVyIGEgcHJvYmFiaWxpdHkgc3BhY2UuCiAgICAiIiIKCiAgICBkaXN0cmliX3Q6IG5wLm5kYXJyYXkKICAgIGRpc3RyaWJfdTogbnAubmRhcnJheQoKICAgIGRlZiBjb21wdXRlKHNlbGYpIC0+IGZsb2F0OgogICAgICAgIHJldHVybiBucC5zcXJ0KAogICAgICAgICAgICAwLjUgKiAoKG5wLnNxcnQoc2VsZi5kaXN0cmliX3UpIC0gbnAuc3FydChzZWxmLmRpc3RyaWJfdCkpICoqIDIpLnN1bSgpCiAgICAgICAgKQoKCkBkYXRhY2xhc3MKY2xhc3MgS3VsbGJhY2tMZWlibGVyRGl2ZXJnZW5jZToKICAgICIiIgogICAgS0wgRGl2ZXJnZW5jZSAob3IgcmVsYXRpdmUgZW50cm9weSkgaXMgYSBtZWFzdXJlIG9mIGhvdyBvbmUgcHJvYmFiaWxpdHkgZGlzdHJpYnV0aW9uIGRpZmZlcnMgZnJvbSBhbm90aGVyLgogICAgSXQgaXMgYW4gYXN5bW1ldHJpYyBtZWFzdXJlICh0aHVzIGl0J3Mgbm90IGEgbWV0cmljKSBhbmQgaXQgZG9lc24ndCBzYXRpc2Z5IHRoZSB0cmlhbmdsZSBpbmVxdWFsaXR5LgogICAgS0wgRGl2ZXJnZW5jZSBvZiAwLCBpbmRpY2F0ZXMgdHdvIGlkZW50aWNhbCBkaXN0cmlidXRpb25zLgogICAgIiIiCgogICAgZGlzdHJpYl90OiBucC5uZGFycmF5CiAgICBkaXN0cmliX3U6IG5wLm5kYXJyYXkKCiAgICBkZWYgY29tcHV0ZShzZWxmLCBjYXBwaW5nPU5vbmUsIGtsZF9zY2FsaW5nPTAuMDAwMSkgLT4gZmxvYXQ6CiAgICAgICAgdF91ID0gbnAuc3VtKAogICAgICAgICAgICBucC53aGVyZSgKICAgICAgICAgICAgICAgIHNlbGYuZGlzdHJpYl90ICE9IDAsCiAgICAgICAgICAgICAgICAoc2VsZi5kaXN0cmliX3QpCiAgICAgICAgICAgICAgICAqIG5wLmxvZygKICAgICAgICAgICAgICAgICAgICBzZWxmLmRpc3RyaWJfdAogICAgICAgICAgICAgICAgICAgIC8gbnAud2hlcmUoc2VsZi5kaXN0cmliX3UgIT0gMCwgc2VsZi5kaXN0cmliX3UsIGtsZF9zY2FsaW5nKQogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICkKICAgICAgICApCiAgICAgICAgdV90ID0gbnAuc3VtKAogICAgICAgICAgICBucC53aGVyZSgKICAgICAgICAgICAgICAgIHNlbGYuZGlzdHJpYl91ICE9IDAsCiAgICAgICAgICAgICAgICAoc2VsZi5kaXN0cmliX3UpCiAgICAgICAgICAgICAgICAqIG5wLmxvZygKICAgICAgICAgICAgICAgICAgICBzZWxmLmRpc3RyaWJfdQogICAgICAgICAgICAgICAgICAgIC8gbnAud2hlcmUoc2VsZi5kaXN0cmliX3QgIT0gMCwgc2VsZi5kaXN0cmliX3QsIGtsZF9zY2FsaW5nKQogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICkKICAgICAgICApCiAgICAgICAgcmVzdWx0ID0gdF91ICsgdV90CiAgICAgICAgaWYgY2FwcGluZzoKICAgICAgICAgICAgcmV0dXJuIGNhcHBpbmcgaWYgcmVzdWx0ID09IGZsb2F0KCJpbmYiKSBlbHNlIHJlc3VsdAogICAgICAgIHJldHVybiByZXN1bHQKCgpjbGFzcyBWaXJ0dWFsRHJpZnQ6CiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBwcmVkaWN0aW9uX2NvbDogT3B0aW9uYWxbc3RyXSA9IE5vbmUsCiAgICAgICAgbGFiZWxfY29sOiBPcHRpb25hbFtzdHJdID0gTm9uZSwKICAgICAgICBmZWF0dXJlX3dlaWdodHM6IE9wdGlvbmFsW0xpc3RbZmxvYXRdXSA9IE5vbmUsCiAgICAgICAgaW5mX2NhcHBpbmc6IE9wdGlvbmFsW2Zsb2F0XSA9IDEwLAogICAgKToKICAgICAgICBzZWxmLnByZWRpY3Rpb25fY29sID0gcHJlZGljdGlvbl9jb2wKICAgICAgICBzZWxmLmxhYmVsX2NvbCA9IGxhYmVsX2NvbAogICAgICAgIHNlbGYuZmVhdHVyZV93ZWlnaHRzID0gZmVhdHVyZV93ZWlnaHRzCiAgICAgICAgc2VsZi5jYXBwaW5nID0gaW5mX2NhcHBpbmcKICAgICAgICBzZWxmLmRpc2NyZXRpemVyczogRGljdFtzdHIsIEtCaW5zRGlzY3JldGl6ZXJdID0ge30KICAgICAgICBzZWxmLm1ldHJpY3MgPSB7CiAgICAgICAgICAgICJ0dmQiOiBUb3RhbFZhcmlhbmNlRGlzdGFuY2UsCiAgICAgICAgICAgICJoZWxsaW5nZXIiOiBIZWxsaW5nZXJEaXN0YW5jZSwKICAgICAgICAgICAgImtsZCI6IEt1bGxiYWNrTGVpYmxlckRpdmVyZ2VuY2UsCiAgICAgICAgfQoKICAgIGRlZiBkaWN0X3RvX2hpc3RvZ3JhbShzZWxmLCBoaXN0b2dyYW1fZGljdCk6CiAgICAgICAgaGlzdG9ncmFtcyA9IHt9CiAgICAgICAgZm9yIGZlYXR1cmUsIHN0YXRzIGluIGhpc3RvZ3JhbV9kaWN0Lml0ZW1zKCk6CiAgICAgICAgICAgIGhpc3RvZ3JhbXNbZmVhdHVyZV0gPSBzdGF0c1siaGlzdCJdWzBdCgogICAgICAgICMgR2V0IGZlYXR1cmVzIHZhbHVlIGNvdW50cwogICAgICAgIGhpc3RvZ3JhbXMgPSBwZC5jb25jYXQoCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIHBkLkRhdGFGcmFtZShkYXRhPWhpc3QsIGNvbHVtbnM9W2ZlYXR1cmVdKQogICAgICAgICAgICAgICAgZm9yIGZlYXR1cmUsIGhpc3QgaW4gaGlzdG9ncmFtcy5pdGVtcygpCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIGF4aXM9MSwKICAgICAgICApCiAgICAgICAgIyBUbyBEaXN0cmlidXRpb24KICAgICAgICBoaXN0b2dyYW1zID0gaGlzdG9ncmFtcyAvIGhpc3RvZ3JhbXMuc3VtKCkKICAgICAgICByZXR1cm4gaGlzdG9ncmFtcwoKICAgIGRlZiBjb21wdXRlX21ldHJpY3Nfb3Zlcl9kZihzZWxmLCBiYXNlX2hpc3RvZ3JhbSwgbGF0ZXN0X2hpc3RvZ3JhbSk6CiAgICAgICAgZHJpZnRfbWVhc3VyZXMgPSB7fQogICAgICAgIGZvciBtZXRyaWNfbmFtZSwgbWV0cmljIGluIHNlbGYubWV0cmljcy5pdGVtcygpOgogICAgICAgICAgICBkcmlmdF9tZWFzdXJlc1ttZXRyaWNfbmFtZV0gPSB7CiAgICAgICAgICAgICAgICBmZWF0dXJlOiBtZXRyaWMoCiAgICAgICAgICAgICAgICAgICAgYmFzZV9oaXN0b2dyYW0ubG9jWzosIGZlYXR1cmVdLCBsYXRlc3RfaGlzdG9ncmFtLmxvY1s6LCBmZWF0dXJlXQogICAgICAgICAgICAgICAgKS5jb21wdXRlKCkKICAgICAgICAgICAgICAgIGZvciBmZWF0dXJlIGluIGJhc2VfaGlzdG9ncmFtCiAgICAgICAgICAgIH0KICAgICAgICByZXR1cm4gZHJpZnRfbWVhc3VyZXMKCiAgICBkZWYgY29tcHV0ZV9kcmlmdF9mcm9tX2hpc3RvZ3JhbXMoc2VsZiwgZmVhdHVyZV9zdGF0cywgY3VycmVudF9zdGF0cyk6CiAgICAgICAgIyBQcm9jZXNzIGhpc3RvZ3JhbSBkaWN0aW9uYXJpZXMgdG8gRGF0YWZyYW1lIG9mIHRoZSBoaXN0b2dyYW1zCiAgICAgICAgIyB3aXRoIEZlYXR1cmUgaGlzdG9ncmFtIGFzIGNvbHMKICAgICAgICBiYXNlX2hpc3RvZ3JhbSA9IHNlbGYuZGljdF90b19oaXN0b2dyYW0oZmVhdHVyZV9zdGF0cykKICAgICAgICBsYXRlc3RfaGlzdG9ncmFtID0gc2VsZi5kaWN0X3RvX2hpc3RvZ3JhbShjdXJyZW50X3N0YXRzKQoKICAgICAgICAjIFZlcmlmeSBhbGwgdGhlIGZlYXR1cmVzIGV4aXN0IGJldHdlZW4gZGF0YXNldHMKICAgICAgICBiYXNlX2ZlYXR1cmVzID0gc2V0KGJhc2VfaGlzdG9ncmFtLmNvbHVtbnMpCiAgICAgICAgbGF0ZXN0X2ZlYXR1cmVzID0gc2V0KGxhdGVzdF9oaXN0b2dyYW0uY29sdW1ucykKCiAgICAgICAgZmVhdHVyZXNfY29tbW9uID0gbGlzdChiYXNlX2ZlYXR1cmVzLmludGVyc2VjdGlvbihsYXRlc3RfZmVhdHVyZXMpKQogICAgICAgIGZlYXR1cmVfZGlmZmVyZW5jZSA9IGxpc3QoYmFzZV9mZWF0dXJlcyBeIGxhdGVzdF9mZWF0dXJlcykKCiAgICAgICAgaWYgbm90IGZlYXR1cmVzX2NvbW1vbjoKICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigKICAgICAgICAgICAgICAgIGYiTm8gY29tbW9uIGZlYXR1cmVzIGZvdW5kOiB7YmFzZV9mZWF0dXJlc30gPD4ge2xhdGVzdF9mZWF0dXJlc30iCiAgICAgICAgICAgICkKCiAgICAgICAgYmFzZV9oaXN0b2dyYW0gPSBiYXNlX2hpc3RvZ3JhbS5kcm9wKAogICAgICAgICAgICBmZWF0dXJlX2RpZmZlcmVuY2UsIGF4aXM9MSwgZXJyb3JzPSJpZ25vcmUiCiAgICAgICAgKQogICAgICAgIGxhdGVzdF9oaXN0b2dyYW0gPSBsYXRlc3RfaGlzdG9ncmFtLmRyb3AoCiAgICAgICAgICAgIGZlYXR1cmVfZGlmZmVyZW5jZSwgYXhpcz0xLCBlcnJvcnM9Imlnbm9yZSIKICAgICAgICApCgogICAgICAgICMgQ29tcHV0ZSB0aGUgZHJpZnQgcGVyIGZlYXR1cmUKICAgICAgICBmZWF0dXJlc19kcmlmdF9tZWFzdXJlcyA9IHNlbGYuY29tcHV0ZV9tZXRyaWNzX292ZXJfZGYoCiAgICAgICAgICAgIGJhc2VfaGlzdG9ncmFtLmxvY1s6LCBmZWF0dXJlc19jb21tb25dLAogICAgICAgICAgICBsYXRlc3RfaGlzdG9ncmFtLmxvY1s6LCBmZWF0dXJlc19jb21tb25dLAogICAgICAgICkKCiAgICAgICAgIyBDb21wdXRlIHRvdGFsIGRyaWZ0IG1lYXN1cmVzIGZvciBmZWF0dXJlcwogICAgICAgIGZvciBtZXRyaWNfbmFtZSBpbiBzZWxmLm1ldHJpY3Mua2V5cygpOgogICAgICAgICAgICBmZWF0dXJlX3ZhbHVlcyA9IGxpc3QoZmVhdHVyZXNfZHJpZnRfbWVhc3VyZXNbbWV0cmljX25hbWVdLnZhbHVlcygpKQogICAgICAgICAgICBmZWF0dXJlc19kcmlmdF9tZWFzdXJlc1ttZXRyaWNfbmFtZV1bInRvdGFsX3N1bSJdID0gbnAuc3VtKGZlYXR1cmVfdmFsdWVzKQogICAgICAgICAgICBmZWF0dXJlc19kcmlmdF9tZWFzdXJlc1ttZXRyaWNfbmFtZV1bInRvdGFsX21lYW4iXSA9IG5wLm1lYW4oZmVhdHVyZV92YWx1ZXMpCgogICAgICAgICAgICAjIEFkZCB3ZWlnaHRlZCBtZWFuIGJ5IGdpdmVuIGZlYXR1cmUgd2VpZ2h0cyBpZiBwcm92aWRlZAogICAgICAgICAgICBpZiBzZWxmLmZlYXR1cmVfd2VpZ2h0czoKICAgICAgICAgICAgICAgIGZlYXR1cmVzX2RyaWZ0X21lYXN1cmVzW21ldHJpY19uYW1lXVsidG90YWxfd2VpZ2h0ZWRfbWVhbiJdID0gbnAuZG90KAogICAgICAgICAgICAgICAgICAgIGZlYXR1cmVfdmFsdWVzLCBzZWxmLmZlYXR1cmVfd2VpZ2h0cwogICAgICAgICAgICAgICAgKQoKICAgICAgICBkcmlmdF9yZXN1bHQgPSBkZWZhdWx0ZGljdChkaWN0KQoKICAgICAgICBmb3IgZmVhdHVyZSBpbiBmZWF0dXJlc19jb21tb246CiAgICAgICAgICAgIGZvciBtZXRyaWMsIHZhbHVlcyBpbiBmZWF0dXJlc19kcmlmdF9tZWFzdXJlcy5pdGVtcygpOgogICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0W2ZlYXR1cmVdW21ldHJpY10gPSB2YWx1ZXNbZmVhdHVyZV0KICAgICAgICAgICAgICAgIHN1bSA9IGZlYXR1cmVzX2RyaWZ0X21lYXN1cmVzW21ldHJpY11bInRvdGFsX3N1bSJdCiAgICAgICAgICAgICAgICBtZWFuID0gZmVhdHVyZXNfZHJpZnRfbWVhc3VyZXNbbWV0cmljXVsidG90YWxfbWVhbiJdCiAgICAgICAgICAgICAgICBkcmlmdF9yZXN1bHRbZiJ7bWV0cmljfV9zdW0iXSA9IHN1bQogICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0W2Yie21ldHJpY31fbWVhbiJdID0gbWVhbgogICAgICAgICAgICAgICAgaWYgc2VsZi5mZWF0dXJlX3dlaWdodHM6CiAgICAgICAgICAgICAgICAgICAgbWV0cmljX21lYXN1cmUgPSBmZWF0dXJlc19kcmlmdF9tZWFzdXJlc1ttZXRyaWNdCiAgICAgICAgICAgICAgICAgICAgd2VpZ2h0ZWRfbWVhbiA9IG1ldHJpY19tZWFzdXJlWyJ0b3RhbF93ZWlnaHRlZF9tZWFuIl0KICAgICAgICAgICAgICAgICAgICBkcmlmdF9yZXN1bHRbZiJ7bWV0cmljfV93ZWlnaHRlZF9tZWFuIl0gPSB3ZWlnaHRlZF9tZWFuCgogICAgICAgIGlmIHNlbGYubGFiZWxfY29sOgogICAgICAgICAgICBsYWJlbF9kcmlmdF9tZWFzdXJlcyA9IHNlbGYuY29tcHV0ZV9tZXRyaWNzX292ZXJfZGYoCiAgICAgICAgICAgICAgICBiYXNlX2hpc3RvZ3JhbS5sb2NbOiwgc2VsZi5sYWJlbF9jb2xdLAogICAgICAgICAgICAgICAgbGF0ZXN0X2hpc3RvZ3JhbS5sb2NbOiwgc2VsZi5sYWJlbF9jb2xdLAogICAgICAgICAgICApCiAgICAgICAgICAgIGZvciBtZXRyaWMsIHZhbHVlcyBpbiBsYWJlbF9kcmlmdF9tZWFzdXJlcy5pdGVtcygpOgogICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0W3NlbGYubGFiZWxfY29sXVttZXRyaWNdID0gdmFsdWVzW21ldHJpY10KCiAgICAgICAgaWYgc2VsZi5wcmVkaWN0aW9uX2NvbDoKICAgICAgICAgICAgcHJlZGljdGlvbl9kcmlmdF9tZWFzdXJlcyA9IHNlbGYuY29tcHV0ZV9tZXRyaWNzX292ZXJfZGYoCiAgICAgICAgICAgICAgICBiYXNlX2hpc3RvZ3JhbS5sb2NbOiwgc2VsZi5wcmVkaWN0aW9uX2NvbF0sCiAgICAgICAgICAgICAgICBsYXRlc3RfaGlzdG9ncmFtLmxvY1s6LCBzZWxmLnByZWRpY3Rpb25fY29sXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBmb3IgbWV0cmljLCB2YWx1ZXMgaW4gcHJlZGljdGlvbl9kcmlmdF9tZWFzdXJlcy5pdGVtcygpOgogICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0W3NlbGYucHJlZGljdGlvbl9jb2xdW21ldHJpY10gPSB2YWx1ZXNbbWV0cmljXQoKICAgICAgICByZXR1cm4gZHJpZnRfcmVzdWx0CgoKY2xhc3MgQmF0Y2hQcm9jZXNzb3I6CiAgICBkZWYgX19pbml0X18oCiAgICAgICAgc2VsZiwKICAgICAgICBjb250ZXh0OiBNTENsaWVudEN0eCwKICAgICAgICBwcm9qZWN0OiBzdHIsCiAgICAgICAgbW9kZWxfbW9uaXRvcmluZ19hY2Nlc3Nfa2V5OiBzdHIsCiMgICAgICAgIHYzaW9fYWNjZXNzX2tleTogc3RyLAogICAgKToKICAgICAgICBzZWxmLmNvbnRleHQgPSBjb250ZXh0CiAgICAgICAgc2VsZi5wcm9qZWN0ID0gcHJvamVjdAoKIyAgICAgICAgc2VsZi52M2lvX2FjY2Vzc19rZXkgPSB2M2lvX2FjY2Vzc19rZXkKICAgICAgICBzZWxmLm1vZGVsX21vbml0b3JpbmdfYWNjZXNzX2tleSA9IG1vZGVsX21vbml0b3JpbmdfYWNjZXNzX2tleQoKICAgICAgICBzZWxmLnZpcnR1YWxfZHJpZnQgPSBWaXJ0dWFsRHJpZnQoaW5mX2NhcHBpbmc9MTApCgogICAgICAgIHRlbXBsYXRlID0gY29uZmlnLm1vZGVsX2VuZHBvaW50X21vbml0b3Jpbmcuc3RvcmVfcHJlZml4ZXMuZGVmYXVsdAoKICAgICAgICBrdl9wYXRoID0gdGVtcGxhdGUuZm9ybWF0KHByb2plY3Q9c2VsZi5wcm9qZWN0LCBraW5kPSJlbmRwb2ludHMiKQogICAgICAgIF8sIHNlbGYua3ZfY29udGFpbmVyLCBzZWxmLmt2X3BhdGggPSBwYXJzZV9tb2RlbF9lbmRwb2ludF9zdG9yZV9wcmVmaXgoa3ZfcGF0aCkKCiAgICAgICAgdHNkYl9wYXRoID0gdGVtcGxhdGUuZm9ybWF0KHByb2plY3Q9cHJvamVjdCwga2luZD0iZXZlbnRzIikKICAgICAgICBfLCBzZWxmLnRzZGJfY29udGFpbmVyLCBzZWxmLnRzZGJfcGF0aCA9IHBhcnNlX21vZGVsX2VuZHBvaW50X3N0b3JlX3ByZWZpeCgKICAgICAgICAgICAgdHNkYl9wYXRoCiAgICAgICAgKQoKICAgICAgICBzdHJlYW1fcGF0aCA9IHRlbXBsYXRlLmZvcm1hdChwcm9qZWN0PXNlbGYucHJvamVjdCwga2luZD0ibG9nX3N0cmVhbSIpCiAgICAgICAgXywgc2VsZi5zdHJlYW1fY29udGFpbmVyLCBzZWxmLnN0cmVhbV9wYXRoID0gcGFyc2VfbW9kZWxfZW5kcG9pbnRfc3RvcmVfcHJlZml4KAogICAgICAgICAgICBzdHJlYW1fcGF0aAogICAgICAgICkKCiAgICAgICAgc2VsZi5wYXJxdWV0X3BhdGggPSBjb25maWcubW9kZWxfZW5kcG9pbnRfbW9uaXRvcmluZy5zdG9yZV9wcmVmaXhlcy51c2VyX3NwYWNlLmZvcm1hdCgKICAgICAgICAgICAgcHJvamVjdD1wcm9qZWN0LCBraW5kPSJwYXJxdWV0IgogICAgICAgICkKCiAgICAgICAgbG9nZ2VyLmluZm8oCiAgICAgICAgICAgICJJbml0aWFsaXppbmcgQmF0Y2hQcm9jZXNzb3IiLAogICAgICAgICAgICBwcm9qZWN0PXByb2plY3QsCiAgICAgICAgICAgIG1vZGVsX21vbml0b3JpbmdfYWNjZXNzX2tleV9pbml0YWxpemVkPWJvb2wobW9kZWxfbW9uaXRvcmluZ19hY2Nlc3Nfa2V5KSwKIyAgICAgICAgICAgIHYzaW9fYWNjZXNzX2tleV9pbml0aWFsaXplZD1ib29sKHYzaW9fYWNjZXNzX2tleSksCiAgICAgICAgICAgIHBhcnF1ZXRfcGF0aD1zZWxmLnBhcnF1ZXRfcGF0aCwKICAgICAgICAgICAga3ZfY29udGFpbmVyPXNlbGYua3ZfY29udGFpbmVyLAogICAgICAgICAgICBrdl9wYXRoPXNlbGYua3ZfcGF0aCwKICAgICAgICAgICAgdHNkYl9jb250YWluZXI9c2VsZi50c2RiX2NvbnRhaW5lciwKICAgICAgICAgICAgdHNkYl9wYXRoPXNlbGYudHNkYl9wYXRoLAogICAgICAgICAgICBzdHJlYW1fY29udGFpbmVyPXNlbGYuc3RyZWFtX2NvbnRhaW5lciwKICAgICAgICAgICAgc3RyZWFtX3BhdGg9c2VsZi5zdHJlYW1fcGF0aCwKICAgICAgICApCgogICAgICAgIHNlbGYuZGVmYXVsdF9wb3NzaWJsZV9kcmlmdF90aHJlc2hvbGQgPSAoCiAgICAgICAgICAgIGNvbmZpZy5tb2RlbF9lbmRwb2ludF9tb25pdG9yaW5nLmRyaWZ0X3RocmVzaG9sZHMuZGVmYXVsdC5wb3NzaWJsZV9kcmlmdAogICAgICAgICkKICAgICAgICBzZWxmLmRlZmF1bHRfZHJpZnRfZGV0ZWN0ZWRfdGhyZXNob2xkID0gKAogICAgICAgICAgICBjb25maWcubW9kZWxfZW5kcG9pbnRfbW9uaXRvcmluZy5kcmlmdF90aHJlc2hvbGRzLmRlZmF1bHQuZHJpZnRfZGV0ZWN0ZWQKICAgICAgICApCgogICAgICAgIHNlbGYuZGIgPSBnZXRfcnVuX2RiKCkKICAgICAgICBzZWxmLnYzaW8gPSBnZXRfdjNpb19jbGllbnQoYWNjZXNzX2tleT1zZWxmLm1vZGVsX21vbml0b3JpbmdfYWNjZXNzX2tleSkKICAgICAgICBzZWxmLmZyYW1lcyA9IGdldF9mcmFtZXNfY2xpZW50KAogICAgICAgICAgICBhZGRyZXNzPWNvbmZpZy52M2lvX2ZyYW1lc2QsCiAgICAgICAgICAgIGNvbnRhaW5lcj1zZWxmLnRzZGJfY29udGFpbmVyLAogICAgICAgICAgICB0b2tlbj1zZWxmLm1vZGVsX21vbml0b3JpbmdfYWNjZXNzX2tleSwKICAgICAgICApCiAgICAgICAgc2VsZi5leGNlcHRpb24gPSBOb25lCgogICAgZGVmIHBvc3RfaW5pdChzZWxmKToKICAgICAgICByZXNwb25zZSA9IHNlbGYudjNpby5jcmVhdGVfc3RyZWFtKAogICAgICAgICAgICBjb250YWluZXI9c2VsZi5zdHJlYW1fY29udGFpbmVyLAogICAgICAgICAgICBwYXRoPXNlbGYuc3RyZWFtX3BhdGgsCiAgICAgICAgICAgIHNoYXJkX2NvdW50PTEsCiAgICAgICAgICAgIHJhaXNlX2Zvcl9zdGF0dXM9djNpby5kYXRhcGxhbmUuUmFpc2VGb3JTdGF0dXMubmV2ZXIsCiAgICAgICAgICAgIGFjY2Vzc19rZXk9c2VsZi5tb2RlbF9tb25pdG9yaW5nX2FjY2Vzc19rZXksCiAgICAgICAgKQoKICAgICAgICBpZiBub3QgKHJlc3BvbnNlLnN0YXR1c19jb2RlID09IDQwMCBhbmQgIlJlc291cmNlSW5Vc2UiIGluIHN0cihyZXNwb25zZS5ib2R5KSk6CiAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoWzQwOSwgMjA0LCA0MDNdKQoKICAgIGRlZiBydW4oc2VsZik6CgogICAgICAgIHRyeToKICAgICAgICAgICAgZW5kcG9pbnRzID0gc2VsZi5kYi5saXN0X21vZGVsX2VuZHBvaW50cyhzZWxmLnByb2plY3QpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkZhaWxlZCB0byBsaXN0IGVuZHBvaW50cyIsIGV4Yz1lKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgYWN0aXZlX2VuZHBvaW50cyA9IHNldCgpCiAgICAgICAgZm9yIGVuZHBvaW50IGluIGVuZHBvaW50cy5lbmRwb2ludHM6CiAgICAgICAgICAgIGlmIGVuZHBvaW50LnNwZWMuYWN0aXZlOgogICAgICAgICAgICAgICAgYWN0aXZlX2VuZHBvaW50cy5hZGQoZW5kcG9pbnQubWV0YWRhdGEudWlkKQoKICAgICAgICBzdG9yZSwgc3ViID0gc3RvcmVfbWFuYWdlci5nZXRfb3JfY3JlYXRlX3N0b3JlKHNlbGYucGFycXVldF9wYXRoKQogICAgICAgIHByZWZpeCA9IHNlbGYucGFycXVldF9wYXRoLnJlcGxhY2Uoc3ViLCAiIikKICAgICAgICBmcyA9IHN0b3JlLmdldF9maWxlc3lzdGVtKHNpbGVudD1GYWxzZSkKCiAgICAgICAgaWYgbm90IGZzLmV4aXN0cyhzdWIpOgogICAgICAgICAgICBsb2dnZXIud2FybigKICAgICAgICAgICAgICAgIGYie3N1Yn0gZG9lcyBub3QgZXhpc3QiCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGZvciBlbmRwb2ludF9kaXIgaW4gZnMubHMoc3ViKToKICAgICAgICAgICAgZW5kcG9pbnRfaWQgPSBlbmRwb2ludF9kaXJbIm5hbWUiXS5zcGxpdCgiPSIpWy0xXQogICAgICAgICAgICBpZiBlbmRwb2ludF9pZCBub3QgaW4gYWN0aXZlX2VuZHBvaW50czoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBsYXN0X3llYXIgPSBzZWxmLmdldF9sYXN0X2NyZWF0ZWRfZGlyKGZzLCBlbmRwb2ludF9kaXIpCiAgICAgICAgICAgICAgICBsYXN0X21vbnRoID0gc2VsZi5nZXRfbGFzdF9jcmVhdGVkX2RpcihmcywgbGFzdF95ZWFyKQogICAgICAgICAgICAgICAgbGFzdF9kYXkgPSBzZWxmLmdldF9sYXN0X2NyZWF0ZWRfZGlyKGZzLCBsYXN0X21vbnRoKQogICAgICAgICAgICAgICAgbGFzdF9ob3VyID0gc2VsZi5nZXRfbGFzdF9jcmVhdGVkX2RpcihmcywgbGFzdF9kYXkpCgogICAgICAgICAgICAgICAgZnVsbF9wYXRoID0gZiJ7cHJlZml4fXtsYXN0X2hvdXJbJ25hbWUnXX0iCgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJOb3cgcHJvY2Vzc2luZyB7ZnVsbF9wYXRofSIpCgogICAgICAgICAgICAgICAgZW5kcG9pbnQgPSBzZWxmLmRiLmdldF9tb2RlbF9lbmRwb2ludCgKICAgICAgICAgICAgICAgICAgICBwcm9qZWN0PXNlbGYucHJvamVjdCwgZW5kcG9pbnRfaWQ9ZW5kcG9pbnRfaWQKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICBpZiBlbmRwb2ludC5zdGF0dXMuZW5kcG9pbnRfdHlwZSA9PSBFbmRwb2ludFR5cGUuUk9VVEVSOgogICAgICAgICAgICAgICAgICAgICMgZW5kcG9pbnQuc3RhdHVzLmZlYXR1cmVfc3RhdHMgaXMgTm9uZQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYie2VuZHBvaW50X2lkfSBpcyByb3V0ZXIgc2tpcHBpbmciKQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICAgICAgZGYgPSBwZC5yZWFkX3BhcnF1ZXQoZnVsbF9wYXRoKQogICAgICAgICAgICAgICAgdGltZXN0YW1wID0gZGZbInRpbWVzdGFtcCJdLmlsb2NbLTFdCgogICAgICAgICAgICAgICAgbmFtZWRfZmVhdHVyZXNfZGYgPSBsaXN0KGRmWyJuYW1lZF9mZWF0dXJlcyJdKQogICAgICAgICAgICAgICAgbmFtZWRfZmVhdHVyZXNfZGYgPSBwZC5EYXRhRnJhbWUobmFtZWRfZmVhdHVyZXNfZGYpCgogICAgICAgICAgICAgICAgY3VycmVudF9zdGF0cyA9IERGRGF0YUluZmVyLmdldF9zdGF0cygKICAgICAgICAgICAgICAgICAgICBkZj1uYW1lZF9mZWF0dXJlc19kZiwgb3B0aW9ucz1JbmZlck9wdGlvbnMuSGlzdG9ncmFtCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0ID0gc2VsZi52aXJ0dWFsX2RyaWZ0LmNvbXB1dGVfZHJpZnRfZnJvbV9oaXN0b2dyYW1zKAogICAgICAgICAgICAgICAgICAgIGZlYXR1cmVfc3RhdHM9ZW5kcG9pbnQuc3RhdHVzLmZlYXR1cmVfc3RhdHMsCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF9zdGF0cz1jdXJyZW50X3N0YXRzLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJEcmlmdCByZXN1bHQiLCBkcmlmdF9yZXN1bHQ9ZHJpZnRfcmVzdWx0KQoKICAgICAgICAgICAgICAgIGRyaWZ0X3N0YXR1cywgZHJpZnRfbWVhc3VyZSA9IHNlbGYuY2hlY2tfZm9yX2RyaWZ0KAogICAgICAgICAgICAgICAgICAgIGRyaWZ0X3Jlc3VsdD1kcmlmdF9yZXN1bHQsIGVuZHBvaW50PWVuZHBvaW50CiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oCiAgICAgICAgICAgICAgICAgICAgIkRyaWZ0IHN0YXR1cyIsCiAgICAgICAgICAgICAgICAgICAgZW5kcG9pbnRfaWQ9ZW5kcG9pbnRfaWQsCiAgICAgICAgICAgICAgICAgICAgZHJpZnRfc3RhdHVzPWRyaWZ0X3N0YXR1cywKICAgICAgICAgICAgICAgICAgICBkcmlmdF9tZWFzdXJlPWRyaWZ0X21lYXN1cmUsCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgaWYgZHJpZnRfc3RhdHVzID09ICJQT1NTSUJMRV9EUklGVCIgb3IgZHJpZnRfc3RhdHVzID09ICJEUklGVF9ERVRFQ1RFRCI6CiAgICAgICAgICAgICAgICAgICAgc2VsZi52M2lvLnN0cmVhbS5wdXRfcmVjb3JkcygKICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyPXNlbGYuc3RyZWFtX2NvbnRhaW5lciwKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtX3BhdGg9c2VsZi5zdHJlYW1fcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3Jkcz1bCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRhdGEiOiBqc29uLmR1bXBzKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZW5kcG9pbnRfaWQiOiBlbmRwb2ludF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkcmlmdF9zdGF0dXMiOiBkcmlmdF9zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZHJpZnRfbWVhc3VyZSI6IGRyaWZ0X21lYXN1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZHJpZnRfcGVyX2ZlYXR1cmUiOiB7KipkcmlmdF9yZXN1bHR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICBzZWxmLnYzaW8ua3YudXBkYXRlKAogICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lcj1zZWxmLmt2X2NvbnRhaW5lciwKICAgICAgICAgICAgICAgICAgICB0YWJsZV9wYXRoPXNlbGYua3ZfcGF0aCwKICAgICAgICAgICAgICAgICAgICBrZXk9ZW5kcG9pbnRfaWQsCiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlcz17CiAgICAgICAgICAgICAgICAgICAgICAgICJjdXJyZW50X3N0YXRzIjoganNvbi5kdW1wcyhjdXJyZW50X3N0YXRzKSwKICAgICAgICAgICAgICAgICAgICAgICAgImRyaWZ0X21lYXN1cmVzIjoganNvbi5kdW1wcyhkcmlmdF9yZXN1bHQpLAogICAgICAgICAgICAgICAgICAgICAgICAiZHJpZnRfc3RhdHVzIjogZHJpZnRfc3RhdHVzLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgdHNkYl9kcmlmdF9tZWFzdXJlcyA9IHsKICAgICAgICAgICAgICAgICAgICAiZW5kcG9pbnRfaWQiOiBlbmRwb2ludF9pZCwKICAgICAgICAgICAgICAgICAgICAidGltZXN0YW1wIjogcGQudG9fZGF0ZXRpbWUodGltZXN0YW1wLCBmb3JtYXQ9VElNRV9GT1JNQVQpLAogICAgICAgICAgICAgICAgICAgICJyZWNvcmRfdHlwZSI6ICJkcmlmdF9tZWFzdXJlcyIsCiAgICAgICAgICAgICAgICAgICAgInR2ZF9tZWFuIjogZHJpZnRfcmVzdWx0WyJ0dmRfbWVhbiJdLAogICAgICAgICAgICAgICAgICAgICJrbGRfbWVhbiI6IGRyaWZ0X3Jlc3VsdFsia2xkX21lYW4iXSwKICAgICAgICAgICAgICAgICAgICAiaGVsbGluZ2VyX21lYW4iOiBkcmlmdF9yZXN1bHRbImhlbGxpbmdlcl9tZWFuIl0sCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc2VsZi5mcmFtZXMud3JpdGUoCiAgICAgICAgICAgICAgICAgICAgYmFja2VuZD0idHNkYiIsCiAgICAgICAgICAgICAgICAgICAgdGFibGU9c2VsZi50c2RiX3BhdGgsCiAgICAgICAgICAgICAgICAgICAgZGZzPXBkLkRhdGFGcmFtZS5mcm9tX2RpY3QoW3RzZGJfZHJpZnRfbWVhc3VyZXNdKSwKICAgICAgICAgICAgICAgICAgICBpbmRleF9jb2xzPVsidGltZXN0YW1wIiwgImVuZHBvaW50X2lkIiwgInJlY29yZF90eXBlIl0sCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJEb25lIHVwZGF0aW5nIGRyaWZ0IG1lYXN1cmVzIHtmdWxsX3BhdGh9IikKCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkV4Y2VwdGlvbiBmb3IgZW5kcG9pbnQge2VuZHBvaW50X2lkfSIpCiAgICAgICAgICAgICAgICBzZWxmLmV4Y2VwdGlvbiA9IGUKCiAgICBkZWYgY2hlY2tfZm9yX2RyaWZ0KHNlbGYsIGRyaWZ0X3Jlc3VsdCwgZW5kcG9pbnQpOgogICAgICAgIHR2ZF9tZWFuID0gZHJpZnRfcmVzdWx0LmdldCgidHZkX21lYW4iKQogICAgICAgIGhlbGxpbmdlcl9tZWFuID0gZHJpZnRfcmVzdWx0LmdldCgiaGVsbGluZ2VyX21lYW4iKQoKICAgICAgICBkcmlmdF9tZWFuID0gMC4wCiAgICAgICAgaWYgdHZkX21lYW4gYW5kIGhlbGxpbmdlcl9tZWFuOgogICAgICAgICAgICBkcmlmdF9tZWFuID0gKHR2ZF9tZWFuICsgaGVsbGluZ2VyX21lYW4pIC8gMgoKICAgICAgICBtb25pdG9yX2NvbmZpZ3VyYXRpb24gPSBlbmRwb2ludC5zcGVjLm1vbml0b3JfY29uZmlndXJhdGlvbiBvciB7fQoKICAgICAgICBwb3NzaWJsZV9kcmlmdCA9IG1vbml0b3JfY29uZmlndXJhdGlvbi5nZXQoCiAgICAgICAgICAgICJwb3NzaWJsZV9kcmlmdCIsIHNlbGYuZGVmYXVsdF9wb3NzaWJsZV9kcmlmdF90aHJlc2hvbGQKICAgICAgICApCiAgICAgICAgZHJpZnRfZGV0ZWN0ZWQgPSBtb25pdG9yX2NvbmZpZ3VyYXRpb24uZ2V0KAogICAgICAgICAgICAicG9zc2libGVfZHJpZnQiLCBzZWxmLmRlZmF1bHRfZHJpZnRfZGV0ZWN0ZWRfdGhyZXNob2xkCiAgICAgICAgKQoKICAgICAgICBkcmlmdF9zdGF0dXMgPSAiTk9fRFJJRlQiCiAgICAgICAgaWYgZHJpZnRfbWVhbiA+PSBkcmlmdF9kZXRlY3RlZDoKICAgICAgICAgICAgZHJpZnRfc3RhdHVzID0gIkRSSUZUX0RFVEVDVEVEIgogICAgICAgIGVsaWYgZHJpZnRfbWVhbiA+PSBwb3NzaWJsZV9kcmlmdDoKICAgICAgICAgICAgZHJpZnRfc3RhdHVzID0gIlBPU1NJQkxFX0RSSUZUIgoKICAgICAgICByZXR1cm4gZHJpZnRfc3RhdHVzLCBkcmlmdF9tZWFuCgogICAgQHN0YXRpY21ldGhvZAogICAgZGVmIGdldF9sYXN0X2NyZWF0ZWRfZGlyKGZzLCBlbmRwb2ludF9kaXIpOgogICAgICAgIGRpcnMgPSBmcy5scyhlbmRwb2ludF9kaXJbIm5hbWUiXSkKICAgICAgICBsYXN0X2RpciA9IHNvcnRlZChkaXJzLCBrZXk9bGFtYmRhIGs6IGtbIm5hbWUiXS5zcGxpdCgiPSIpWy0xXSlbLTFdCiAgICAgICAgcmV0dXJuIGxhc3RfZGlyCgoKZGVmIGhhbmRsZXIoY29udGV4dDogTUxDbGllbnRDdHgpOgogICAgYmF0Y2hfcHJvY2Vzc29yID0gQmF0Y2hQcm9jZXNzb3IoCiAgICAgICAgY29udGV4dD1jb250ZXh0LAogICAgICAgIHByb2plY3Q9Y29udGV4dC5wcm9qZWN0LAogICAgICAgIG1vZGVsX21vbml0b3JpbmdfYWNjZXNzX2tleT1vcy5lbnZpcm9uLmdldCgiTU9ERUxfTU9OSVRPUklOR19BQ0NFU1NfS0VZIiksCiMgICAgICAgIHYzaW9fYWNjZXNzX2tleT1vcy5lbnZpcm9uLmdldCgiVjNJT19BQ0NFU1NfS0VZIiksCiAgICApCiAgICBiYXRjaF9wcm9jZXNzb3IucG9zdF9pbml0KCkKICAgIGJhdGNoX3Byb2Nlc3Nvci5ydW4oKQogICAgaWYgYmF0Y2hfcHJvY2Vzc29yLmV4Y2VwdGlvbjoKICAgICAgICByYWlzZSBiYXRjaF9wcm9jZXNzb3IuZXhjZXB0aW9uCg==
    commands: []
    code_origin: https://github.com/katyakats/functions.git#4709a4cf94b5315f8a07a0b4bd4d2149339ad2b0:/Users/katyak/work/functions/model_monitoring_batch/model_monitoring_batch.py
    origin_filename: /Users/katyak/work/functions/model_monitoring_batch/model_monitoring_batch.py
  disable_auto_mount: false
  priority_class_name: ''
  affinity: null
verbose: false
