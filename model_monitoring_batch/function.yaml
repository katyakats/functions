kind: job
metadata:
  name: model-monitoring-batch
  tag: ''
  hash: f778ae811ccbd5ea39252032de6b09737339a8d1
  project: default
  categories:
  - monitoring
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  env: []
  default_handler: handler
  entry_points:
    compute:
      name: compute
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: capping
        default: null
      - name: kld_scaling
        default: 0.0001
      outputs:
      - default: ''
        type: float
      lineno: 64
    dict_to_histogram:
      name: dict_to_histogram
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: histogram_dict
        default: ''
      outputs:
      - default: ''
      lineno: 112
    compute_metrics_over_df:
      name: compute_metrics_over_df
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: base_histogram
        default: ''
      - name: latest_histogram
        default: ''
      outputs:
      - default: ''
      lineno: 129
    compute_drift_from_histograms:
      name: compute_drift_from_histograms
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: feature_stats
        default: ''
      - name: current_stats
        default: ''
      outputs:
      - default: ''
      lineno: 140
    post_init:
      name: post_init
      doc: ''
      parameters:
      - name: self
        default: ''
      outputs:
      - default: ''
      lineno: 284
    run:
      name: run
      doc: ''
      parameters:
      - name: self
        default: ''
      outputs:
      - default: ''
      lineno: 296
    check_for_drift:
      name: check_for_drift
      doc: ''
      parameters:
      - name: self
        default: ''
      - name: drift_result
        default: ''
      - name: endpoint
        default: ''
      outputs:
      - default: ''
      lineno: 422
    get_last_created_dir:
      name: get_last_created_dir
      doc: ''
      parameters:
      - name: fs
        default: ''
      - name: endpoint_dir
        default: ''
      outputs:
      - default: ''
      lineno: 448
    handler:
      name: handler
      doc: ''
      parameters:
      - name: context
        type: MLClientCtx
        default: ''
      outputs:
      - default: ''
      lineno: 454
  description: ''
  build:
    functionSourceCode: aW1wb3J0IGpzb24KaW1wb3J0IG9zCmZyb20gY29sbGVjdGlvbnMgaW1wb3J0IGRlZmF1bHRkaWN0CmZyb20gZGF0YWNsYXNzZXMgaW1wb3J0IGRhdGFjbGFzcwpmcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIExpc3QsIERpY3QKCmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgcGFuZGFzIGFzIHBkCmltcG9ydCB2M2lvCmZyb20gbWxydW4gaW1wb3J0IGdldF9ydW5fZGIKZnJvbSBtbHJ1biBpbXBvcnQgc3RvcmVfbWFuYWdlcgpmcm9tIG1scnVuLmRhdGFfdHlwZXMuaW5mZXIgaW1wb3J0IERGRGF0YUluZmVyLCBJbmZlck9wdGlvbnMKZnJvbSBtbHJ1bi5ydW4gaW1wb3J0IE1MQ2xpZW50Q3R4CmZyb20gbWxydW4udXRpbHMgaW1wb3J0IGxvZ2dlciwgY29uZmlnCmZyb20gbWxydW4udXRpbHMubW9kZWxfbW9uaXRvcmluZyBpbXBvcnQgcGFyc2VfbW9kZWxfZW5kcG9pbnRfc3RvcmVfcHJlZml4CmZyb20gbWxydW4udXRpbHMudjNpb19jbGllbnRzIGltcG9ydCBnZXRfdjNpb19jbGllbnQsIGdldF9mcmFtZXNfY2xpZW50CmZyb20gc2tsZWFybi5wcmVwcm9jZXNzaW5nIGltcG9ydCBLQmluc0Rpc2NyZXRpemVyCgpUSU1FX0ZPUk1BVCA9ICIlWS0lbS0lZCAlSDolTTolUy4lZiV6IgoKCkBkYXRhY2xhc3MKY2xhc3MgVG90YWxWYXJpYW5jZURpc3RhbmNlOgogICAgIiIiCiAgICBQcm92aWRlcyBhIHN5bW1ldHJpYyBkcmlmdCBkaXN0YW5jZSBiZXR3ZWVuIHR3byBwZXJpb2RzIHQgYW5kIHUKICAgIFogLSB2ZWN0b3Igb2YgcmFuZG9tIHZhcmlhYmxlcwogICAgUHQgLSBQcm9iYWJpbGl0eSBkaXN0cmlidXRpb24gb3ZlciB0aW1lIHNwYW4gdAogICAgIiIiCgogICAgZGlzdHJpYl90OiBucC5uZGFycmF5CiAgICBkaXN0cmliX3U6IG5wLm5kYXJyYXkKCiAgICBkZWYgY29tcHV0ZShzZWxmKSAtPiBmbG9hdDoKICAgICAgICByZXR1cm4gbnAuc3VtKG5wLmFicyhzZWxmLmRpc3RyaWJfdCAtIHNlbGYuZGlzdHJpYl91KSkgLyAyCgoKQGRhdGFjbGFzcwpjbGFzcyBIZWxsaW5nZXJEaXN0YW5jZToKICAgICIiIgogICAgSGVsbGluZ2VyIGRpc3RhbmNlIGlzIGFuIGYgZGl2ZXJnZW5jZSBtZWFzdXJlLCBzaW1pbGFyIHRvIHRoZSBLdWxsYmFjay1MZWlibGVyIChLTCkgZGl2ZXJnZW5jZS4KICAgIEhvd2V2ZXIsIHVubGlrZSBLTCBEaXZlcmdlbmNlIHRoZSBIZWxsaW5nZXIgZGl2ZXJnZW5jZSBpcyBzeW1tZXRyaWMgYW5kIGJvdW5kZWQgb3ZlciBhIHByb2JhYmlsaXR5IHNwYWNlLgogICAgIiIiCgogICAgZGlzdHJpYl90OiBucC5uZGFycmF5CiAgICBkaXN0cmliX3U6IG5wLm5kYXJyYXkKCiAgICBkZWYgY29tcHV0ZShzZWxmKSAtPiBmbG9hdDoKICAgICAgICByZXR1cm4gbnAuc3FydCgKICAgICAgICAgICAgMC41ICogKChucC5zcXJ0KHNlbGYuZGlzdHJpYl91KSAtIG5wLnNxcnQoc2VsZi5kaXN0cmliX3QpKSAqKiAyKS5zdW0oKQogICAgICAgICkKCgpAZGF0YWNsYXNzCmNsYXNzIEt1bGxiYWNrTGVpYmxlckRpdmVyZ2VuY2U6CiAgICAiIiIKICAgIEtMIERpdmVyZ2VuY2UgKG9yIHJlbGF0aXZlIGVudHJvcHkpIGlzIGEgbWVhc3VyZSBvZiBob3cgb25lIHByb2JhYmlsaXR5IGRpc3RyaWJ1dGlvbiBkaWZmZXJzIGZyb20gYW5vdGhlci4KICAgIEl0IGlzIGFuIGFzeW1tZXRyaWMgbWVhc3VyZSAodGh1cyBpdCdzIG5vdCBhIG1ldHJpYykgYW5kIGl0IGRvZXNuJ3Qgc2F0aXNmeSB0aGUgdHJpYW5nbGUgaW5lcXVhbGl0eS4KICAgIEtMIERpdmVyZ2VuY2Ugb2YgMCwgaW5kaWNhdGVzIHR3byBpZGVudGljYWwgZGlzdHJpYnV0aW9ucy4KICAgICIiIgoKICAgIGRpc3RyaWJfdDogbnAubmRhcnJheQogICAgZGlzdHJpYl91OiBucC5uZGFycmF5CgogICAgZGVmIGNvbXB1dGUoc2VsZiwgY2FwcGluZz1Ob25lLCBrbGRfc2NhbGluZz0wLjAwMDEpIC0+IGZsb2F0OgogICAgICAgIHRfdSA9IG5wLnN1bSgKICAgICAgICAgICAgbnAud2hlcmUoCiAgICAgICAgICAgICAgICBzZWxmLmRpc3RyaWJfdCAhPSAwLAogICAgICAgICAgICAgICAgKHNlbGYuZGlzdHJpYl90KQogICAgICAgICAgICAgICAgKiBucC5sb2coCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kaXN0cmliX3QKICAgICAgICAgICAgICAgICAgICAvIG5wLndoZXJlKHNlbGYuZGlzdHJpYl91ICE9IDAsIHNlbGYuZGlzdHJpYl91LCBrbGRfc2NhbGluZykKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICApCiAgICAgICAgKQogICAgICAgIHVfdCA9IG5wLnN1bSgKICAgICAgICAgICAgbnAud2hlcmUoCiAgICAgICAgICAgICAgICBzZWxmLmRpc3RyaWJfdSAhPSAwLAogICAgICAgICAgICAgICAgKHNlbGYuZGlzdHJpYl91KQogICAgICAgICAgICAgICAgKiBucC5sb2coCiAgICAgICAgICAgICAgICAgICAgc2VsZi5kaXN0cmliX3UKICAgICAgICAgICAgICAgICAgICAvIG5wLndoZXJlKHNlbGYuZGlzdHJpYl90ICE9IDAsIHNlbGYuZGlzdHJpYl90LCBrbGRfc2NhbGluZykKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICApCiAgICAgICAgKQogICAgICAgIHJlc3VsdCA9IHRfdSArIHVfdAogICAgICAgIGlmIGNhcHBpbmc6CiAgICAgICAgICAgIHJldHVybiBjYXBwaW5nIGlmIHJlc3VsdCA9PSBmbG9hdCgiaW5mIikgZWxzZSByZXN1bHQKICAgICAgICByZXR1cm4gcmVzdWx0CgoKY2xhc3MgVmlydHVhbERyaWZ0OgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsCiAgICAgICAgcHJlZGljdGlvbl9jb2w6IE9wdGlvbmFsW3N0cl0gPSBOb25lLAogICAgICAgIGxhYmVsX2NvbDogT3B0aW9uYWxbc3RyXSA9IE5vbmUsCiAgICAgICAgZmVhdHVyZV93ZWlnaHRzOiBPcHRpb25hbFtMaXN0W2Zsb2F0XV0gPSBOb25lLAogICAgICAgIGluZl9jYXBwaW5nOiBPcHRpb25hbFtmbG9hdF0gPSAxMCwKICAgICk6CiAgICAgICAgc2VsZi5wcmVkaWN0aW9uX2NvbCA9IHByZWRpY3Rpb25fY29sCiAgICAgICAgc2VsZi5sYWJlbF9jb2wgPSBsYWJlbF9jb2wKICAgICAgICBzZWxmLmZlYXR1cmVfd2VpZ2h0cyA9IGZlYXR1cmVfd2VpZ2h0cwogICAgICAgIHNlbGYuY2FwcGluZyA9IGluZl9jYXBwaW5nCiAgICAgICAgc2VsZi5kaXNjcmV0aXplcnM6IERpY3Rbc3RyLCBLQmluc0Rpc2NyZXRpemVyXSA9IHt9CiAgICAgICAgc2VsZi5tZXRyaWNzID0gewogICAgICAgICAgICAidHZkIjogVG90YWxWYXJpYW5jZURpc3RhbmNlLAogICAgICAgICAgICAiaGVsbGluZ2VyIjogSGVsbGluZ2VyRGlzdGFuY2UsCiAgICAgICAgICAgICJrbGQiOiBLdWxsYmFja0xlaWJsZXJEaXZlcmdlbmNlLAogICAgICAgIH0KCiAgICBkZWYgZGljdF90b19oaXN0b2dyYW0oc2VsZiwgaGlzdG9ncmFtX2RpY3QpOgogICAgICAgIGhpc3RvZ3JhbXMgPSB7fQogICAgICAgIGZvciBmZWF0dXJlLCBzdGF0cyBpbiBoaXN0b2dyYW1fZGljdC5pdGVtcygpOgogICAgICAgICAgICBoaXN0b2dyYW1zW2ZlYXR1cmVdID0gc3RhdHNbImhpc3QiXVswXQoKICAgICAgICAjIEdldCBmZWF0dXJlcyB2YWx1ZSBjb3VudHMKICAgICAgICBoaXN0b2dyYW1zID0gcGQuY29uY2F0KAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBwZC5EYXRhRnJhbWUoZGF0YT1oaXN0LCBjb2x1bW5zPVtmZWF0dXJlXSkKICAgICAgICAgICAgICAgIGZvciBmZWF0dXJlLCBoaXN0IGluIGhpc3RvZ3JhbXMuaXRlbXMoKQogICAgICAgICAgICBdLAogICAgICAgICAgICBheGlzPTEsCiAgICAgICAgKQogICAgICAgICMgVG8gRGlzdHJpYnV0aW9uCiAgICAgICAgaGlzdG9ncmFtcyA9IGhpc3RvZ3JhbXMgLyBoaXN0b2dyYW1zLnN1bSgpCiAgICAgICAgcmV0dXJuIGhpc3RvZ3JhbXMKCiAgICBkZWYgY29tcHV0ZV9tZXRyaWNzX292ZXJfZGYoc2VsZiwgYmFzZV9oaXN0b2dyYW0sIGxhdGVzdF9oaXN0b2dyYW0pOgogICAgICAgIGRyaWZ0X21lYXN1cmVzID0ge30KICAgICAgICBmb3IgbWV0cmljX25hbWUsIG1ldHJpYyBpbiBzZWxmLm1ldHJpY3MuaXRlbXMoKToKICAgICAgICAgICAgZHJpZnRfbWVhc3VyZXNbbWV0cmljX25hbWVdID0gewogICAgICAgICAgICAgICAgZmVhdHVyZTogbWV0cmljKAogICAgICAgICAgICAgICAgICAgIGJhc2VfaGlzdG9ncmFtLmxvY1s6LCBmZWF0dXJlXSwgbGF0ZXN0X2hpc3RvZ3JhbS5sb2NbOiwgZmVhdHVyZV0KICAgICAgICAgICAgICAgICkuY29tcHV0ZSgpCiAgICAgICAgICAgICAgICBmb3IgZmVhdHVyZSBpbiBiYXNlX2hpc3RvZ3JhbQogICAgICAgICAgICB9CiAgICAgICAgcmV0dXJuIGRyaWZ0X21lYXN1cmVzCgogICAgZGVmIGNvbXB1dGVfZHJpZnRfZnJvbV9oaXN0b2dyYW1zKHNlbGYsIGZlYXR1cmVfc3RhdHMsIGN1cnJlbnRfc3RhdHMpOgogICAgICAgICMgUHJvY2VzcyBoaXN0b2dyYW0gZGljdGlvbmFyaWVzIHRvIERhdGFmcmFtZSBvZiB0aGUgaGlzdG9ncmFtcwogICAgICAgICMgd2l0aCBGZWF0dXJlIGhpc3RvZ3JhbSBhcyBjb2xzCiAgICAgICAgYmFzZV9oaXN0b2dyYW0gPSBzZWxmLmRpY3RfdG9faGlzdG9ncmFtKGZlYXR1cmVfc3RhdHMpCiAgICAgICAgbGF0ZXN0X2hpc3RvZ3JhbSA9IHNlbGYuZGljdF90b19oaXN0b2dyYW0oY3VycmVudF9zdGF0cykKCiAgICAgICAgIyBWZXJpZnkgYWxsIHRoZSBmZWF0dXJlcyBleGlzdCBiZXR3ZWVuIGRhdGFzZXRzCiAgICAgICAgYmFzZV9mZWF0dXJlcyA9IHNldChiYXNlX2hpc3RvZ3JhbS5jb2x1bW5zKQogICAgICAgIGxhdGVzdF9mZWF0dXJlcyA9IHNldChsYXRlc3RfaGlzdG9ncmFtLmNvbHVtbnMpCgogICAgICAgIGZlYXR1cmVzX2NvbW1vbiA9IGxpc3QoYmFzZV9mZWF0dXJlcy5pbnRlcnNlY3Rpb24obGF0ZXN0X2ZlYXR1cmVzKSkKICAgICAgICBmZWF0dXJlX2RpZmZlcmVuY2UgPSBsaXN0KGJhc2VfZmVhdHVyZXMgXiBsYXRlc3RfZmVhdHVyZXMpCgogICAgICAgIGlmIG5vdCBmZWF0dXJlc19jb21tb246CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoCiAgICAgICAgICAgICAgICBmIk5vIGNvbW1vbiBmZWF0dXJlcyBmb3VuZDoge2Jhc2VfZmVhdHVyZXN9IDw+IHtsYXRlc3RfZmVhdHVyZXN9IgogICAgICAgICAgICApCgogICAgICAgIGJhc2VfaGlzdG9ncmFtID0gYmFzZV9oaXN0b2dyYW0uZHJvcCgKICAgICAgICAgICAgZmVhdHVyZV9kaWZmZXJlbmNlLCBheGlzPTEsIGVycm9ycz0iaWdub3JlIgogICAgICAgICkKICAgICAgICBsYXRlc3RfaGlzdG9ncmFtID0gbGF0ZXN0X2hpc3RvZ3JhbS5kcm9wKAogICAgICAgICAgICBmZWF0dXJlX2RpZmZlcmVuY2UsIGF4aXM9MSwgZXJyb3JzPSJpZ25vcmUiCiAgICAgICAgKQoKICAgICAgICAjIENvbXB1dGUgdGhlIGRyaWZ0IHBlciBmZWF0dXJlCiAgICAgICAgZmVhdHVyZXNfZHJpZnRfbWVhc3VyZXMgPSBzZWxmLmNvbXB1dGVfbWV0cmljc19vdmVyX2RmKAogICAgICAgICAgICBiYXNlX2hpc3RvZ3JhbS5sb2NbOiwgZmVhdHVyZXNfY29tbW9uXSwKICAgICAgICAgICAgbGF0ZXN0X2hpc3RvZ3JhbS5sb2NbOiwgZmVhdHVyZXNfY29tbW9uXSwKICAgICAgICApCgogICAgICAgICMgQ29tcHV0ZSB0b3RhbCBkcmlmdCBtZWFzdXJlcyBmb3IgZmVhdHVyZXMKICAgICAgICBmb3IgbWV0cmljX25hbWUgaW4gc2VsZi5tZXRyaWNzLmtleXMoKToKICAgICAgICAgICAgZmVhdHVyZV92YWx1ZXMgPSBsaXN0KGZlYXR1cmVzX2RyaWZ0X21lYXN1cmVzW21ldHJpY19uYW1lXS52YWx1ZXMoKSkKICAgICAgICAgICAgZmVhdHVyZXNfZHJpZnRfbWVhc3VyZXNbbWV0cmljX25hbWVdWyJ0b3RhbF9zdW0iXSA9IG5wLnN1bShmZWF0dXJlX3ZhbHVlcykKICAgICAgICAgICAgZmVhdHVyZXNfZHJpZnRfbWVhc3VyZXNbbWV0cmljX25hbWVdWyJ0b3RhbF9tZWFuIl0gPSBucC5tZWFuKGZlYXR1cmVfdmFsdWVzKQoKICAgICAgICAgICAgIyBBZGQgd2VpZ2h0ZWQgbWVhbiBieSBnaXZlbiBmZWF0dXJlIHdlaWdodHMgaWYgcHJvdmlkZWQKICAgICAgICAgICAgaWYgc2VsZi5mZWF0dXJlX3dlaWdodHM6CiAgICAgICAgICAgICAgICBmZWF0dXJlc19kcmlmdF9tZWFzdXJlc1ttZXRyaWNfbmFtZV1bInRvdGFsX3dlaWdodGVkX21lYW4iXSA9IG5wLmRvdCgKICAgICAgICAgICAgICAgICAgICBmZWF0dXJlX3ZhbHVlcywgc2VsZi5mZWF0dXJlX3dlaWdodHMKICAgICAgICAgICAgICAgICkKCiAgICAgICAgZHJpZnRfcmVzdWx0ID0gZGVmYXVsdGRpY3QoZGljdCkKCiAgICAgICAgZm9yIGZlYXR1cmUgaW4gZmVhdHVyZXNfY29tbW9uOgogICAgICAgICAgICBmb3IgbWV0cmljLCB2YWx1ZXMgaW4gZmVhdHVyZXNfZHJpZnRfbWVhc3VyZXMuaXRlbXMoKToKICAgICAgICAgICAgICAgIGRyaWZ0X3Jlc3VsdFtmZWF0dXJlXVttZXRyaWNdID0gdmFsdWVzW2ZlYXR1cmVdCiAgICAgICAgICAgICAgICBzdW0gPSBmZWF0dXJlc19kcmlmdF9tZWFzdXJlc1ttZXRyaWNdWyJ0b3RhbF9zdW0iXQogICAgICAgICAgICAgICAgbWVhbiA9IGZlYXR1cmVzX2RyaWZ0X21lYXN1cmVzW21ldHJpY11bInRvdGFsX21lYW4iXQogICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0W2Yie21ldHJpY31fc3VtIl0gPSBzdW0KICAgICAgICAgICAgICAgIGRyaWZ0X3Jlc3VsdFtmInttZXRyaWN9X21lYW4iXSA9IG1lYW4KICAgICAgICAgICAgICAgIGlmIHNlbGYuZmVhdHVyZV93ZWlnaHRzOgogICAgICAgICAgICAgICAgICAgIG1ldHJpY19tZWFzdXJlID0gZmVhdHVyZXNfZHJpZnRfbWVhc3VyZXNbbWV0cmljXQogICAgICAgICAgICAgICAgICAgIHdlaWdodGVkX21lYW4gPSBtZXRyaWNfbWVhc3VyZVsidG90YWxfd2VpZ2h0ZWRfbWVhbiJdCiAgICAgICAgICAgICAgICAgICAgZHJpZnRfcmVzdWx0W2Yie21ldHJpY31fd2VpZ2h0ZWRfbWVhbiJdID0gd2VpZ2h0ZWRfbWVhbgoKICAgICAgICBpZiBzZWxmLmxhYmVsX2NvbDoKICAgICAgICAgICAgbGFiZWxfZHJpZnRfbWVhc3VyZXMgPSBzZWxmLmNvbXB1dGVfbWV0cmljc19vdmVyX2RmKAogICAgICAgICAgICAgICAgYmFzZV9oaXN0b2dyYW0ubG9jWzosIHNlbGYubGFiZWxfY29sXSwKICAgICAgICAgICAgICAgIGxhdGVzdF9oaXN0b2dyYW0ubG9jWzosIHNlbGYubGFiZWxfY29sXSwKICAgICAgICAgICAgKQogICAgICAgICAgICBmb3IgbWV0cmljLCB2YWx1ZXMgaW4gbGFiZWxfZHJpZnRfbWVhc3VyZXMuaXRlbXMoKToKICAgICAgICAgICAgICAgIGRyaWZ0X3Jlc3VsdFtzZWxmLmxhYmVsX2NvbF1bbWV0cmljXSA9IHZhbHVlc1ttZXRyaWNdCgogICAgICAgIGlmIHNlbGYucHJlZGljdGlvbl9jb2w6CiAgICAgICAgICAgIHByZWRpY3Rpb25fZHJpZnRfbWVhc3VyZXMgPSBzZWxmLmNvbXB1dGVfbWV0cmljc19vdmVyX2RmKAogICAgICAgICAgICAgICAgYmFzZV9oaXN0b2dyYW0ubG9jWzosIHNlbGYucHJlZGljdGlvbl9jb2xdLAogICAgICAgICAgICAgICAgbGF0ZXN0X2hpc3RvZ3JhbS5sb2NbOiwgc2VsZi5wcmVkaWN0aW9uX2NvbF0sCiAgICAgICAgICAgICkKICAgICAgICAgICAgZm9yIG1ldHJpYywgdmFsdWVzIGluIHByZWRpY3Rpb25fZHJpZnRfbWVhc3VyZXMuaXRlbXMoKToKICAgICAgICAgICAgICAgIGRyaWZ0X3Jlc3VsdFtzZWxmLnByZWRpY3Rpb25fY29sXVttZXRyaWNdID0gdmFsdWVzW21ldHJpY10KCiAgICAgICAgcmV0dXJuIGRyaWZ0X3Jlc3VsdAoKCmNsYXNzIEJhdGNoUHJvY2Vzc29yOgogICAgZGVmIF9faW5pdF9fKAogICAgICAgIHNlbGYsCiAgICAgICAgY29udGV4dDogTUxDbGllbnRDdHgsCiAgICAgICAgcHJvamVjdDogc3RyLAogICAgICAgIG1vZGVsX21vbml0b3JpbmdfYWNjZXNzX2tleTogc3RyLAogICAgICAgIHYzaW9fYWNjZXNzX2tleTogc3RyLAogICAgKToKICAgICAgICBzZWxmLmNvbnRleHQgPSBjb250ZXh0CiAgICAgICAgc2VsZi5wcm9qZWN0ID0gcHJvamVjdAoKICAgICAgICBzZWxmLnYzaW9fYWNjZXNzX2tleSA9IHYzaW9fYWNjZXNzX2tleQogICAgICAgIHNlbGYubW9kZWxfbW9uaXRvcmluZ19hY2Nlc3Nfa2V5ID0gKAogICAgICAgICAgICBtb2RlbF9tb25pdG9yaW5nX2FjY2Vzc19rZXkgb3IgdjNpb19hY2Nlc3Nfa2V5CiAgICAgICAgKQoKICAgICAgICBwcmludChmIkREREREREQge21vZGVsX21vbml0b3JpbmdfYWNjZXNzX2tleX0ge3YzaW9fYWNjZXNzX2tleX0iKQoKICAgICAgICBzZWxmLnZpcnR1YWxfZHJpZnQgPSBWaXJ0dWFsRHJpZnQoaW5mX2NhcHBpbmc9MTApCgogICAgICAgIHRlbXBsYXRlID0gY29uZmlnLm1vZGVsX2VuZHBvaW50X21vbml0b3Jpbmcuc3RvcmVfcHJlZml4ZXMuZGVmYXVsdAoKICAgICAgICBrdl9wYXRoID0gdGVtcGxhdGUuZm9ybWF0KHByb2plY3Q9c2VsZi5wcm9qZWN0LCBraW5kPSJlbmRwb2ludHMiKQogICAgICAgIF8sIHNlbGYua3ZfY29udGFpbmVyLCBzZWxmLmt2X3BhdGggPSBwYXJzZV9tb2RlbF9lbmRwb2ludF9zdG9yZV9wcmVmaXgoa3ZfcGF0aCkKCiAgICAgICAgdHNkYl9wYXRoID0gdGVtcGxhdGUuZm9ybWF0KHByb2plY3Q9cHJvamVjdCwga2luZD0iZXZlbnRzIikKICAgICAgICBfLCBzZWxmLnRzZGJfY29udGFpbmVyLCBzZWxmLnRzZGJfcGF0aCA9IHBhcnNlX21vZGVsX2VuZHBvaW50X3N0b3JlX3ByZWZpeCgKICAgICAgICAgICAgdHNkYl9wYXRoCiAgICAgICAgKQoKICAgICAgICBzdHJlYW1fcGF0aCA9IHRlbXBsYXRlLmZvcm1hdChwcm9qZWN0PXNlbGYucHJvamVjdCwga2luZD0ibG9nX3N0cmVhbSIpCiAgICAgICAgXywgc2VsZi5zdHJlYW1fY29udGFpbmVyLCBzZWxmLnN0cmVhbV9wYXRoID0gcGFyc2VfbW9kZWxfZW5kcG9pbnRfc3RvcmVfcHJlZml4KAogICAgICAgICAgICBzdHJlYW1fcGF0aAogICAgICAgICkKCiAgICAgICAgc2VsZi5wYXJxdWV0X3BhdGggPSBjb25maWcubW9kZWxfZW5kcG9pbnRfbW9uaXRvcmluZy5zdG9yZV9wcmVmaXhlcy51c2VyX3NwYWNlLmZvcm1hdCgKICAgICAgICAgICAgcHJvamVjdD1wcm9qZWN0LCBraW5kPSJwYXJxdWV0IgogICAgICAgICkKCiAgICAgICAgbG9nZ2VyLmluZm8oCiAgICAgICAgICAgICJJbml0aWFsaXppbmcgQmF0Y2hQcm9jZXNzb3IiLAogICAgICAgICAgICBwcm9qZWN0PXByb2plY3QsCiAgICAgICAgICAgIG1vZGVsX21vbml0b3JpbmdfYWNjZXNzX2tleV9pbml0YWxpemVkPWJvb2wobW9kZWxfbW9uaXRvcmluZ19hY2Nlc3Nfa2V5KSwKICAgICAgICAgICAgdjNpb19hY2Nlc3Nfa2V5X2luaXRpYWxpemVkPWJvb2wodjNpb19hY2Nlc3Nfa2V5KSwKICAgICAgICAgICAgcGFycXVldF9wYXRoPXNlbGYucGFycXVldF9wYXRoLAogICAgICAgICAgICBrdl9jb250YWluZXI9c2VsZi5rdl9jb250YWluZXIsCiAgICAgICAgICAgIGt2X3BhdGg9c2VsZi5rdl9wYXRoLAogICAgICAgICAgICB0c2RiX2NvbnRhaW5lcj1zZWxmLnRzZGJfY29udGFpbmVyLAogICAgICAgICAgICB0c2RiX3BhdGg9c2VsZi50c2RiX3BhdGgsCiAgICAgICAgICAgIHN0cmVhbV9jb250YWluZXI9c2VsZi5zdHJlYW1fY29udGFpbmVyLAogICAgICAgICAgICBzdHJlYW1fcGF0aD1zZWxmLnN0cmVhbV9wYXRoLAogICAgICAgICkKCiAgICAgICAgc2VsZi5kZWZhdWx0X3Bvc3NpYmxlX2RyaWZ0X3RocmVzaG9sZCA9ICgKICAgICAgICAgICAgY29uZmlnLm1vZGVsX2VuZHBvaW50X21vbml0b3JpbmcuZHJpZnRfdGhyZXNob2xkcy5kZWZhdWx0LnBvc3NpYmxlX2RyaWZ0CiAgICAgICAgKQogICAgICAgIHNlbGYuZGVmYXVsdF9kcmlmdF9kZXRlY3RlZF90aHJlc2hvbGQgPSAoCiAgICAgICAgICAgIGNvbmZpZy5tb2RlbF9lbmRwb2ludF9tb25pdG9yaW5nLmRyaWZ0X3RocmVzaG9sZHMuZGVmYXVsdC5kcmlmdF9kZXRlY3RlZAogICAgICAgICkKCiAgICAgICAgc2VsZi5kYiA9IGdldF9ydW5fZGIoKQogICAgICAgIHNlbGYudjNpbyA9IGdldF92M2lvX2NsaWVudChhY2Nlc3Nfa2V5PXNlbGYudjNpb19hY2Nlc3Nfa2V5KQogICAgICAgIHNlbGYuZnJhbWVzID0gZ2V0X2ZyYW1lc19jbGllbnQoCiAgICAgICAgICAgIGFkZHJlc3M9Y29uZmlnLnYzaW9fZnJhbWVzZCwKICAgICAgICAgICAgY29udGFpbmVyPXNlbGYudHNkYl9jb250YWluZXIsCiAgICAgICAgICAgIHRva2VuPXNlbGYudjNpb19hY2Nlc3Nfa2V5LAogICAgICAgICkKCiAgICBkZWYgcG9zdF9pbml0KHNlbGYpOgogICAgICAgIHJlc3BvbnNlID0gc2VsZi52M2lvLmNyZWF0ZV9zdHJlYW0oCiAgICAgICAgICAgIGNvbnRhaW5lcj1zZWxmLnN0cmVhbV9jb250YWluZXIsCiAgICAgICAgICAgIHBhdGg9c2VsZi5zdHJlYW1fcGF0aCwKICAgICAgICAgICAgc2hhcmRfY291bnQ9MSwKICAgICAgICAgICAgcmFpc2VfZm9yX3N0YXR1cz12M2lvLmRhdGFwbGFuZS5SYWlzZUZvclN0YXR1cy5uZXZlciwKICAgICAgICAgICAgYWNjZXNzX2tleT1zZWxmLnYzaW9fYWNjZXNzX2tleSwKICAgICAgICApCgogICAgICAgIGlmIG5vdCAocmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gNDAwIGFuZCAiUmVzb3VyY2VJblVzZSIgaW4gc3RyKHJlc3BvbnNlLmJvZHkpKToKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cyhbNDA5LCAyMDQsIDQwM10pCgogICAgZGVmIHJ1bihzZWxmKToKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBlbmRwb2ludHMgPSBzZWxmLmRiLmxpc3RfbW9kZWxfZW5kcG9pbnRzKHNlbGYucHJvamVjdCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRmFpbGVkIHRvIGxpc3QgZW5kcG9pbnRzIiwgZXhjPWUpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBhY3RpdmVfZW5kcG9pbnRzID0gc2V0KCkKICAgICAgICBmb3IgZW5kcG9pbnQgaW4gZW5kcG9pbnRzLmVuZHBvaW50czoKICAgICAgICAgICAgaWYgZW5kcG9pbnQuc3BlYy5hY3RpdmU6CiAgICAgICAgICAgICAgICBhY3RpdmVfZW5kcG9pbnRzLmFkZChlbmRwb2ludC5tZXRhZGF0YS51aWQpCgogICAgICAgIHN0b3JlLCBzdWIgPSBzdG9yZV9tYW5hZ2VyLmdldF9vcl9jcmVhdGVfc3RvcmUoc2VsZi5wYXJxdWV0X3BhdGgpCiAgICAgICAgcHJlZml4ID0gc2VsZi5wYXJxdWV0X3BhdGgucmVwbGFjZShzdWIsICIiKQogICAgICAgIGZzID0gc3RvcmUuZ2V0X2ZpbGVzeXN0ZW0oc2lsZW50PUZhbHNlKQoKICAgICAgICBpZiBub3QgZnMuZXhpc3RzKHN1Yik6CiAgICAgICAgICAgIGxvZ2dlci53YXJuKAogICAgICAgICAgICAgICAgZiJ7c3VifSBkb2VzIG5vdCBleGlzdCIKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgZm9yIGVuZHBvaW50X2RpciBpbiBmcy5scyhzdWIpOgogICAgICAgICAgICBlbmRwb2ludF9pZCA9IGVuZHBvaW50X2RpclsibmFtZSJdLnNwbGl0KCI9IilbLTFdCiAgICAgICAgICAgIGlmIGVuZHBvaW50X2lkIG5vdCBpbiBhY3RpdmVfZW5kcG9pbnRzOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGxhc3RfeWVhciA9IHNlbGYuZ2V0X2xhc3RfY3JlYXRlZF9kaXIoZnMsIGVuZHBvaW50X2RpcikKICAgICAgICAgICAgICAgIGxhc3RfbW9udGggPSBzZWxmLmdldF9sYXN0X2NyZWF0ZWRfZGlyKGZzLCBsYXN0X3llYXIpCiAgICAgICAgICAgICAgICBsYXN0X2RheSA9IHNlbGYuZ2V0X2xhc3RfY3JlYXRlZF9kaXIoZnMsIGxhc3RfbW9udGgpCiAgICAgICAgICAgICAgICBsYXN0X2hvdXIgPSBzZWxmLmdldF9sYXN0X2NyZWF0ZWRfZGlyKGZzLCBsYXN0X2RheSkKCiAgICAgICAgICAgICAgICBmdWxsX3BhdGggPSBmIntwcmVmaXh9e2xhc3RfaG91clsnbmFtZSddfSIKCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIk5vdyBwcm9jZXNzaW5nIHtmdWxsX3BhdGh9IikKCiAgICAgICAgICAgICAgICBlbmRwb2ludCA9IHNlbGYuZGIuZ2V0X21vZGVsX2VuZHBvaW50KAogICAgICAgICAgICAgICAgICAgIHByb2plY3Q9c2VsZi5wcm9qZWN0LCBlbmRwb2ludF9pZD1lbmRwb2ludF9pZAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGRmID0gcGQucmVhZF9wYXJxdWV0KGZ1bGxfcGF0aCkKICAgICAgICAgICAgICAgIHRpbWVzdGFtcCA9IGRmWyJ0aW1lc3RhbXAiXS5pbG9jWy0xXQoKICAgICAgICAgICAgICAgIG5hbWVkX2ZlYXR1cmVzX2RmID0gbGlzdChkZlsibmFtZWRfZmVhdHVyZXMiXSkKICAgICAgICAgICAgICAgIG5hbWVkX2ZlYXR1cmVzX2RmID0gcGQuRGF0YUZyYW1lKG5hbWVkX2ZlYXR1cmVzX2RmKQoKICAgICAgICAgICAgICAgIGN1cnJlbnRfc3RhdHMgPSBERkRhdGFJbmZlci5nZXRfc3RhdHMoCiAgICAgICAgICAgICAgICAgICAgZGY9bmFtZWRfZmVhdHVyZXNfZGYsIG9wdGlvbnM9SW5mZXJPcHRpb25zLkhpc3RvZ3JhbQogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGRyaWZ0X3Jlc3VsdCA9IHNlbGYudmlydHVhbF9kcmlmdC5jb21wdXRlX2RyaWZ0X2Zyb21faGlzdG9ncmFtcygKICAgICAgICAgICAgICAgICAgICBmZWF0dXJlX3N0YXRzPWVuZHBvaW50LnN0YXR1cy5mZWF0dXJlX3N0YXRzLAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfc3RhdHM9Y3VycmVudF9zdGF0cywKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiRHJpZnQgcmVzdWx0IiwgZHJpZnRfcmVzdWx0PWRyaWZ0X3Jlc3VsdCkKCiAgICAgICAgICAgICAgICBkcmlmdF9zdGF0dXMsIGRyaWZ0X21lYXN1cmUgPSBzZWxmLmNoZWNrX2Zvcl9kcmlmdCgKICAgICAgICAgICAgICAgICAgICBkcmlmdF9yZXN1bHQ9ZHJpZnRfcmVzdWx0LCBlbmRwb2ludD1lbmRwb2ludAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKAogICAgICAgICAgICAgICAgICAgICJEcmlmdCBzdGF0dXMiLAogICAgICAgICAgICAgICAgICAgIGVuZHBvaW50X2lkPWVuZHBvaW50X2lkLAogICAgICAgICAgICAgICAgICAgIGRyaWZ0X3N0YXR1cz1kcmlmdF9zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgZHJpZnRfbWVhc3VyZT1kcmlmdF9tZWFzdXJlLAogICAgICAgICAgICAgICAgKQoKICAgICAgICAgICAgICAgIGlmIGRyaWZ0X3N0YXR1cyA9PSAiUE9TU0lCTEVfRFJJRlQiIG9yIGRyaWZ0X3N0YXR1cyA9PSAiRFJJRlRfREVURUNURUQiOgogICAgICAgICAgICAgICAgICAgIHByaW50KCJKSkpKSkpKSkogMSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi52M2lvLnN0cmVhbS5wdXRfcmVjb3JkcygKICAgICAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyPXNlbGYuc3RyZWFtX2NvbnRhaW5lciwKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtX3BhdGg9c2VsZi5zdHJlYW1fcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3Jkcz1bCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImRhdGEiOiBqc29uLmR1bXBzKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZW5kcG9pbnRfaWQiOiBlbmRwb2ludF9pZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJkcmlmdF9zdGF0dXMiOiBkcmlmdF9zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZHJpZnRfbWVhc3VyZSI6IGRyaWZ0X21lYXN1cmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZHJpZnRfcGVyX2ZlYXR1cmUiOiB7KipkcmlmdF9yZXN1bHR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICBwcmludCgiSkpKSkpKSkpKIDIiKQoKICAgICAgICAgICAgICAgIHNlbGYudjNpby5rdi51cGRhdGUoCiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyPXNlbGYua3ZfY29udGFpbmVyLAogICAgICAgICAgICAgICAgICAgIHRhYmxlX3BhdGg9c2VsZi5rdl9wYXRoLAogICAgICAgICAgICAgICAgICAgIGtleT1lbmRwb2ludF9pZCwKICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzPXsKICAgICAgICAgICAgICAgICAgICAgICAgImN1cnJlbnRfc3RhdHMiOiBqc29uLmR1bXBzKGN1cnJlbnRfc3RhdHMpLAogICAgICAgICAgICAgICAgICAgICAgICAiZHJpZnRfbWVhc3VyZXMiOiBqc29uLmR1bXBzKGRyaWZ0X3Jlc3VsdCksCiAgICAgICAgICAgICAgICAgICAgICAgICJkcmlmdF9zdGF0dXMiOiBkcmlmdF9zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICkKCiAgICAgICAgICAgICAgICBwcmludCgiSkpKSkpKSkpKIDMiKQoKICAgICAgICAgICAgICAgIHRzZGJfZHJpZnRfbWVhc3VyZXMgPSB7CiAgICAgICAgICAgICAgICAgICAgImVuZHBvaW50X2lkIjogZW5kcG9pbnRfaWQsCiAgICAgICAgICAgICAgICAgICAgInRpbWVzdGFtcCI6IHBkLnRvX2RhdGV0aW1lKHRpbWVzdGFtcCwgZm9ybWF0PVRJTUVfRk9STUFUKSwKICAgICAgICAgICAgICAgICAgICAicmVjb3JkX3R5cGUiOiAiZHJpZnRfbWVhc3VyZXMiLAogICAgICAgICAgICAgICAgICAgICJ0dmRfbWVhbiI6IGRyaWZ0X3Jlc3VsdFsidHZkX21lYW4iXSwKICAgICAgICAgICAgICAgICAgICAia2xkX21lYW4iOiBkcmlmdF9yZXN1bHRbImtsZF9tZWFuIl0sCiAgICAgICAgICAgICAgICAgICAgImhlbGxpbmdlcl9tZWFuIjogZHJpZnRfcmVzdWx0WyJoZWxsaW5nZXJfbWVhbiJdLAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHByaW50KCJKSkpKSkpKSkogNCIpCgogICAgICAgICAgICAgICAgc2VsZi5mcmFtZXMud3JpdGUoCiAgICAgICAgICAgICAgICAgICAgYmFja2VuZD0idHNkYiIsCiAgICAgICAgICAgICAgICAgICAgdGFibGU9c2VsZi50c2RiX3BhdGgsCiAgICAgICAgICAgICAgICAgICAgZGZzPXBkLkRhdGFGcmFtZS5mcm9tX2RpY3QoW3RzZGJfZHJpZnRfbWVhc3VyZXNdKSwKICAgICAgICAgICAgICAgICAgICBpbmRleF9jb2xzPVsidGltZXN0YW1wIiwgImVuZHBvaW50X2lkIiwgInJlY29yZF90eXBlIl0sCiAgICAgICAgICAgICAgICApCgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJEb25lIHVwZGF0aW5nIGRyaWZ0IG1lYXN1cmVzIHtmdWxsX3BhdGh9IikKCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlKQoKICAgIGRlZiBjaGVja19mb3JfZHJpZnQoc2VsZiwgZHJpZnRfcmVzdWx0LCBlbmRwb2ludCk6CiAgICAgICAgdHZkX21lYW4gPSBkcmlmdF9yZXN1bHQuZ2V0KCJ0dmRfbWVhbiIpCiAgICAgICAgaGVsbGluZ2VyX21lYW4gPSBkcmlmdF9yZXN1bHQuZ2V0KCJoZWxsaW5nZXJfbWVhbiIpCgogICAgICAgIGRyaWZ0X21lYW4gPSAwLjAKICAgICAgICBpZiB0dmRfbWVhbiBhbmQgaGVsbGluZ2VyX21lYW46CiAgICAgICAgICAgIGRyaWZ0X21lYW4gPSAodHZkX21lYW4gKyBoZWxsaW5nZXJfbWVhbikgLyAyCgogICAgICAgIG1vbml0b3JfY29uZmlndXJhdGlvbiA9IGVuZHBvaW50LnNwZWMubW9uaXRvcl9jb25maWd1cmF0aW9uIG9yIHt9CgogICAgICAgIHBvc3NpYmxlX2RyaWZ0ID0gbW9uaXRvcl9jb25maWd1cmF0aW9uLmdldCgKICAgICAgICAgICAgInBvc3NpYmxlX2RyaWZ0Iiwgc2VsZi5kZWZhdWx0X3Bvc3NpYmxlX2RyaWZ0X3RocmVzaG9sZAogICAgICAgICkKICAgICAgICBkcmlmdF9kZXRlY3RlZCA9IG1vbml0b3JfY29uZmlndXJhdGlvbi5nZXQoCiAgICAgICAgICAgICJwb3NzaWJsZV9kcmlmdCIsIHNlbGYuZGVmYXVsdF9kcmlmdF9kZXRlY3RlZF90aHJlc2hvbGQKICAgICAgICApCgogICAgICAgIGRyaWZ0X3N0YXR1cyA9ICJOT19EUklGVCIKICAgICAgICBpZiBkcmlmdF9tZWFuID49IGRyaWZ0X2RldGVjdGVkOgogICAgICAgICAgICBkcmlmdF9zdGF0dXMgPSAiRFJJRlRfREVURUNURUQiCiAgICAgICAgZWxpZiBkcmlmdF9tZWFuID49IHBvc3NpYmxlX2RyaWZ0OgogICAgICAgICAgICBkcmlmdF9zdGF0dXMgPSAiUE9TU0lCTEVfRFJJRlQiCgogICAgICAgIHJldHVybiBkcmlmdF9zdGF0dXMsIGRyaWZ0X21lYW4KCiAgICBAc3RhdGljbWV0aG9kCiAgICBkZWYgZ2V0X2xhc3RfY3JlYXRlZF9kaXIoZnMsIGVuZHBvaW50X2Rpcik6CiAgICAgICAgZGlycyA9IGZzLmxzKGVuZHBvaW50X2RpclsibmFtZSJdKQogICAgICAgIGxhc3RfZGlyID0gc29ydGVkKGRpcnMsIGtleT1sYW1iZGEgazoga1sibmFtZSJdLnNwbGl0KCI9IilbLTFdKVstMV0KICAgICAgICByZXR1cm4gbGFzdF9kaXIKCgpkZWYgaGFuZGxlcihjb250ZXh0OiBNTENsaWVudEN0eCk6CiAgICBiYXRjaF9wcm9jZXNzb3IgPSBCYXRjaFByb2Nlc3NvcigKICAgICAgICBjb250ZXh0PWNvbnRleHQsCiAgICAgICAgcHJvamVjdD1jb250ZXh0LnByb2plY3QsCiAgICAgICAgbW9kZWxfbW9uaXRvcmluZ19hY2Nlc3Nfa2V5PW9zLmVudmlyb24uZ2V0KCJNT0RFTF9NT05JVE9SSU5HX0FDQ0VTU19LRVkiKSwKICAgICAgICB2M2lvX2FjY2Vzc19rZXk9b3MuZW52aXJvbi5nZXQoIlYzSU9fQUNDRVNTX0tFWSIpLAogICAgKQogICAgYmF0Y2hfcHJvY2Vzc29yLnBvc3RfaW5pdCgpCiAgICBiYXRjaF9wcm9jZXNzb3IucnVuKCkK
    commands: []
    code_origin: https://github.com/katyakats/functions.git#1b2d2571baeed7e8c7886d43e8188f9904740745:/Users/katyak/work/functions/model_monitoring_batch/model_monitoring_batch.py
    origin_filename: /Users/katyak/work/functions/model_monitoring_batch/model_monitoring_batch.py
  disable_auto_mount: false
  priority_class_name: ''
  affinity: null
verbose: false
